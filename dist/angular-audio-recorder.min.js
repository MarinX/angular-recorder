!function(){"use strict";window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,angular.module("angularAudioRecorder",["angularAudioRecorder.config","angularAudioRecorder.services","angularAudioRecorder.controllers","angularAudioRecorder.directives"]),angular.module("angularAudioRecorder.config",[]).constant("recorderScriptUrl",function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].getAttribute("src"),r=t.substr(0,t.lastIndexOf("/")+1),n=document.createElement("a");return n.href=r,n.href}()).constant("recorderPlaybackStatus",{STOPPED:0,PLAYING:1,PAUSED:2}),angular.module("angularAudioRecorder.controllers",["angularAudioRecorder.config","angularAudioRecorder.services"]);var e=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&Object.defineProperty(t,r,{get:function(t){var r=t;return function(){return e[r]}}(r),enumerable:!0,configurable:!0});return t},t=function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)},r=function(r,n,o,i,a,c,l){var s=function(e){var t=i.$root.$$phase;return"$apply"!==t&&"$digest"!==t?i.$apply(e):void 0},d=this,u={recorder:null,url:null,player:null},f=null,p="recorded-audio-"+d.id,v={isRecording:!1,playback:l.STOPPED,isDenied:null,isSwfLoaded:null,isConverting:!1,get isPlaying(){return v.playback===l.PLAYING},get isStopped(){return v.playback===l.STOPPED},get isPaused(){return v.playback===l.PAUSED}},g=angular.isDefined(d.convertMp3)?!!d.convertMp3:n.shouldConvertToMp3(),m=g?new MP3Converter(n.getMp3Config()):null;d.timeLimit=d.timeLimit||0,d.status=e(v),d.isAvailable=n.isAvailable(),d.elapsedTime=0,d.id||(d.id=o.generateUuid(),r.attr("id",d.id)),n.isHtml5||n.isCordova||(v.isSwfLoaded=n.swfIsLoaded(),i.$watch(function(){return n.swfIsLoaded()},function(e){v.isSwfLoaded=e})),n.setController(d.id,this);var h=function(){v.playback=l.STOPPED,d.onPlaybackComplete(),s()},w=function(){v.playback=l.PAUSED,d.onPlaybackPause()},y=function(){v.playback=l.PLAYING,d.onPlaybackStart()},b=function(){v.playback=l.PLAYING,d.onPlaybackResume()},A=function(e){if(null==document.getElementById(p)){r.append('<audio type="audio/mp3" id="'+p+'"></audio>');var n=document.getElementById(p);d.showPlayer&&n.setAttribute("controls",""),n.addEventListener("ended",h),n.addEventListener("pause",function(e){this.duration!==this.currentTime&&(w(),s()),n.volume=0}),n.addEventListener("playing",function(e){v.isPaused?b():y(),s()})}e?t(e,function(e){document.getElementById(p).src=e}):document.getElementById(p).removeAttribute("src")},R=function(e,t){m&&(v.isConverting=!0,m.convert(e,function(e){v.isConverting=!1,t&&t(e),s(d.onConversionComplete)},function(){v.isConverting=!1}),d.onConversionStart())};d.getAudioPlayer=function(){return n.isCordova?u.player:document.getElementById(p)},d.startRecord=function(){if(n.isAvailable()){v.isPlaying&&(d.playbackPause(),v.playback=l.STOPPED),d.audioModel=null;var e=d.id,t=n.getHandler(),r=function(){if(n.isCordova)u.url=o.cordovaAudioUrl(d.id),u.recorder=new Media(u.url,function(){console.log("Media successfully played")},function(e){console.log("Media could not be launched"+e.code,e)}),console.log("CordovaRecording"),u.recorder.startRecord();else if(n.isHtml5){if(!t)return;console.log("HTML5Recording"),t.clear(),t.record()}else{if(!n.isReady)return;console.log("FlashRecording"),t.record(e,"audio.wav")}v.isRecording=!0,d.onRecordStart(),d.elapsedTime=0,f=c(function(){++d.elapsedTime,d.timeLimit&&d.timeLimit>0&&d.elapsedTime>=d.timeLimit&&d.stopRecord()},1e3)};n.isCordova||t?r():v.isDenied||n.showPermission({onDenied:function(){v.isDenied=!0,i.$apply()},onAllowed:function(){v.isDenied=!1,t=n.getHandler(),r(),s()}})}},d.stopRecord=function(){var e=d.id;if(!n.isAvailable()||!v.isRecording)return!1;var t=n.getHandler(),r=function(e){c.cancel(f),v.isRecording=!1;var t=function(e){d.audioModel=e,A(e)};g?R(e,t):t(e),A(null),d.onRecordComplete()};n.isCordova?(u.recorder.stopRecord(),window.resolveLocalFileSystemURL(u.url,function(e){e.file(function(e){r(e)})},function(e){console.log("Could not retrieve file, error code:",e.code)})):n.isHtml5?(t.stop(),t.getBuffer(function(){t.exportWAV(function(e){r(e),s()})})):(t.stopRecording(e),r(t.getBlob(e)))},d.playbackRecording=function(){return v.isPlaying||!n.isAvailable()||v.isRecording||!d.audioModel?!1:void(n.isCordova?(u.player=new Media(u.url,h,function(){console.log("Playback failed")}),u.player.play(),y()):d.getAudioPlayer().play())},d.playbackPause=function(){return v.isPlaying&&n.isAvailable()&&!v.isRecording&&d.audioModel?(d.getAudioPlayer().pause(),void(n.isCordova&&w())):!1},d.playbackResume=function(){return v.isPlaying||!n.isAvailable()||v.isRecording||!d.audioModel?!1:void(v.isPaused?(d.getAudioPlayer().play(),n.isCordova&&b()):d.playbackRecording())},d.save=function(e){if(!n.isAvailable()||v.isRecording||!d.audioModel)return!1;e||(e="audio_recording_"+d.id+(d.audioModel.type.indexOf("mp3")>-1?"mp3":"wav"));var t=window.URL.createObjectURL(d.audioModel),r=document.createElement("a");r.href=t,r.target="_blank",r.download=e;var o=document.createEvent("Event");o.initEvent("click",!0,!0),r.dispatchEvent(o)},d.isHtml5=function(){return n.isHtml5},d.autoStart&&a(function(){d.startRecord()},1e3),r.on("$destroy",function(){c.cancel(f)})};r.$inject=["$element","recorderService","recorderUtils","$scope","$timeout","$interval","recorderPlaybackStatus"],angular.module("angularAudioRecorder.controllers").controller("recorderController",r),angular.module("angularAudioRecorder.directives",["angularAudioRecorder.config","angularAudioRecorder.services","angularAudioRecorder.controllers"]),angular.module("angularAudioRecorder.directives").directive("ngAudioRecorderAnalyzer",["recorderService","recorderUtils",function(e,t){var r=function(r,n,o,i){function a(e){if(!u){var t=n.find("canvas")[0];o.width&&!isNaN(o.width)&&(t.width=o.width),o.height&&!isNaN(o.height)&&(t.height=parseInt(o.height)),l=t.width,s=t.height,u=t.getContext("2d")}var r=3,i=1,c=Math.round(l/r),p=new Uint8Array(f.analyserNode.frequencyBinCount);f.analyserNode.getByteFrequencyData(p),u.clearRect(0,0,l,s),u.lineCap="round";for(var v=f.analyserNode.frequencyBinCount/c,g=0;c>g;++g){for(var m=0,h=Math.floor(g*v),w=0;v>w;w++)m+=p[h+w];m/=v;p[g*v];o.waveColor?u.fillStyle=o.waveColor:u.fillStyle="hsl( "+Math.round(360*g/c)+", 100%, 50%)",u.fillRect(g*r,s,i,-m)}d=window.requestAnimationFrame(a)}function c(){window.cancelAnimationFrame(d),d=null}if(!e.isHtml5)return void(r.hide=!0);var l,s,d,u,f=e.$html5AudioProps;n.on("$destroy",function(){c()}),i.onRecordStart=function(e){return function(){e.apply(),a()}}(i.onRecordStart),t.appendActionToCallback(i,"onRecordStart",a,"analyzer"),t.appendActionToCallback(i,"onRecordComplete",c,"analyzer")};return{restrict:"E",require:"^ngAudioRecorder",template:'<div ng-if="!hide" class="audioRecorder-analyzer"><canvas class="analyzer" width="1200" height="400" style="max-width: 100%;"></canvas></div>',link:r}}]),angular.module("angularAudioRecorder.directives").directive("ngAudioRecorderWaveView",["recorderService","recorderUtils","$log",function(e,t,r){return{restrict:"E",require:"^ngAudioRecorder",link:function(n,o,i,a){if(!window.WaveSurfer)return void r.warn("WaveSurfer was found.");var c;o.html('<div class="waveSurfer"></div>');var l=angular.extend({container:o.find("div")[0]},i);e.createWaveSurfer(l),t.appendActionToCallback(a,"onPlaybackStart|onPlaybackResume",function(){e.getWaveSurfer().play()},"waveView"),t.appendActionToCallback(a,"onPlaybackComplete|onPlaybackPause",function(){e.getWaveSurfer().pause()},"waveView"),t.appendActionToCallback(a,"onRecordComplete",function(){c||(c=a.getAudioPlayer(),c.volume=0,c.addEventListener("seeking",function(t){var r=c.currentTime/c.duration;e.getWaveSurfer().seekTo(r)}))},"waveView"),n.$watch(function(){return a.audioModel},function(t){t instanceof Blob&&e.getWaveSurfer().loadBlob(t)})}}}]),angular.module("angularAudioRecorder.directives").directive("ngAudioRecorder",["recorderService","$timeout",function(e,t){return{restrict:"EA",scope:{audioModel:"=",id:"@",onRecordStart:"&",onRecordComplete:"&",onPlaybackComplete:"&",onPlaybackStart:"&",onPlaybackPause:"&",onPlaybackResume:"&",onConversionStart:"&",onConversionComplete:"&",showPlayer:"=?",autoStart:"=?",convertMp3:"=?",timeLimit:"=?"},controllerAs:"recorder",bindToController:!0,template:function(e,t){return'<div class="audioRecorder"><div style="width: 250px; margin: 0 auto;"><div id="audioRecorder-fwrecorder"></div></div>'+e.html()+"</div>"},controller:"recorderController",link:function(r,n,o){t(function(){if(e.isAvailable&&!e.isHtml5&&!e.isCordova){var t={allowscriptaccess:"always"},r={id:"recorder-app",name:"recorder-app"},n={save_text:""};swfobject.embedSWF(e.getSwfUrl(),"audioRecorder-fwrecorder","0","0","11.0.0","",n,t,r)}},100)}}}]),angular.module("angularAudioRecorder.services",["angularAudioRecorder.config"]),angular.module("angularAudioRecorder.services").provider("recorderService",["recorderScriptUrl",function(e){var t,r=null,n={isHtml5:!1,isReady:!1},o={onDenied:null,onClosed:null,onAllow:null},i=!1,a=e+"../lib/recorder.swf",c=!1,l={bitRate:92,lameJsUrl:e+"../lib/lame.min.js"},s=null,d={isAvailable:!1,loaded:!1,configureMic:function(){FWRecorder.isReady&&(FWRecorder.configure(44,100,0,2e3),FWRecorder.setUseEchoSuppression(!1),FWRecorder.setLoopBack(!1))},allowed:!1,externalEvents:function(e){arguments[1];switch(arguments[0]){case"ready":parseInt(arguments[1]),parseInt(arguments[2]);FWRecorder.connect("recorder-app",0),FWRecorder.recorderOriginalWidth=1,FWRecorder.recorderOriginalHeight=1,d.loaded=!0;break;case"microphone_user_request":FWRecorder.showPermissionWindow({permanent:!0});break;case"microphone_connected":console.log("Permission to use MIC granted"),d.allowed=!0;break;case"microphone_not_connected":console.log("Permission to use MIC denied"),d.allowed=!1;break;case"permission_panel_closed":d.allowed?d.setAllowed():d.setDeclined(),FWRecorder.defaultSize(),angular.isFunction(o.onClosed)&&o.onClosed();break;case"recording":FWRecorder.hide();break;case"recording_stopped":FWRecorder.hide();break;case"playing":break;case"playback_started":arguments[2];break;case"save_pressed":FWRecorder.updateForm();break;case"saving":break;case"saved":var t=$.parseJSON(arguments[2]);t.saved;break;case"save_failed":arguments[2];break;case"save_progress":arguments[2],arguments[3];break;case"stopped":case"playing_paused":case"no_microphone_found":case"observing_level":case"microphone_level":case"microphone_activity":case"observing_level_stopped":}},isInstalled:function(){return swfobject.getFlashPlayerVersion().major>0},init:function(){return n.isHtml5=!1,d.isInstalled()?(d.isAvailable=!0,window.fwr_event_handler=d.externalEvents,void(window.configureMicrophone=d.configureMic)):void console.log("Flash is not installed, application cannot be initialized")},setAllowed:function(){n.isReady=!0,r=FWRecorder,angular.isFunction(o.onAllowed)&&o.onAllowed()},setDeclined:function(){n.isReady=!1,r=null,angular.isFunction(o.onDenied)&&o.onDenied()},getPermission:function(){d.isAvailable&&(FWRecorder.isMicrophoneAccessible()?(d.allowed=!0,setTimeout(function(){d.setAllowed()},100)):FWRecorder.showPermissionWindow({permanent:!0}))}},u={audioContext:null,inputPoint:null,audioInput:null,audioRecorder:null,analyserNode:null},f={gotStream:function(e){var t=u.audioContext;u.audioInput=t.createMediaStreamSource(e),u.audioInput.connect(u.inputPoint=t.createGain()),u.analyserNode=t.createAnalyser(),u.analyserNode.fftSize=2048,u.inputPoint.connect(u.analyserNode),u.audioRecorder=new Recorder(u.audioInput);var i=t.createGain();i.gain.value=0,u.inputPoint.connect(i),i.connect(t.destination),n.isReady=!0,r=u.audioRecorder,angular.isFunction(o.onAllowed)&&("https:"==window.location.protocol&&localStorage.setItem("permission","given"),o.onAllowed())},failStream:function(e){angular.isDefined(o.onDenied)&&o.onDenied()},getPermission:function(){navigator.getUserMedia({audio:!0},f.gotStream,f.failStream)},init:function(){n.isHtml5=!0;var e=window.AudioContext||window.webkitAudioContext;e&&!u.audioContext&&(u.audioContext=new e),null!==localStorage.getItem("permission")&&f.getPermission()}};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,n.isCordova=!1;var p=function(){"cordova"in window?n.isCordova=!0:!i&&navigator.getUserMedia?f.init():d.init()},v={};n.controller=function(e){return v[e]},n.getSwfUrl=function(){return a},n.setController=function(e,t){v[e]=t},n.isAvailable=function(){if(n.isCordova){if(!("Media"in window))throw new Error('The Media plugin for cordova is required for this library, add plugin using "cordova plugin add cordova-plugin-media"');return!0}return n.isHtml5||d.isInstalled()},n.getHandler=function(){return r},n.showPermission=function(e){return n.isAvailable()?(e&&angular.extend(o,e),void(n.isHtml5?f.getPermission():d.getPermission())):void console.warn("Neither HTML5 nor SWF is supported.")},n.swfIsLoaded=function(){return d.loaded},n.shouldConvertToMp3=function(){return c},n.getMp3Config=function(){return l},n.createWaveSurfer=function(e){s=WaveSurfer.create(e)},n.getWaveSurfer=function(){return s},n.getWaveSurferAudioContext=function(){return s.backend.ac},n.setWavesurferFilter=function(e){s.backend.setFilters(e)},n.$html5AudioProps=u;var g={$get:["recorderUtils",function(e){return t=e,p(),n}],forceSwf:function(e){return i=e,g},setSwfUrl:function(e){return a=e,g},withMp3Conversion:function(e,t){return c=!!e,l=angular.extend(l,t||{}),g}};return g}]),angular.module("angularAudioRecorder.services").factory("recorderUtils",[function(){var e={generateUuid:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},cordovaAudioUrl:function(e){if(!window.cordova)return"record-audio"+e+".wav";var t=cordova.file.tempDirectory||cordova.file.externalApplicationStorageDirectory||cordova.file.sharedDirectory;switch(t+=Date.now()+"_recordedAudio_"+e.replace("/[^A-Za-z0-9_-]+/gi","-"),window.cordova.platformId){case"ios":t+=".wav";break;case"android":t+=".amr";break;case"wp":t+=".wma";break;default:t+=".mp3"}return t}};return e.appendActionToCallback=function(e,t,r,n){t.split(/\|/).forEach(function(t){if(!(angular.isObject(e)&&angular.isFunction(r)&&t in e&&angular.isFunction(e[t])))throw new Error("One or more parameter supplied is not valid");"$$appendTrackers"in e||(e.$$appendTrackers=[]);var o=t+"|"+n;return e.$$appendTrackers.indexOf(o)>-1?void console.log("Already appended: ",o):(e[t]=function(t){return function(){t.apply(e,arguments),r.apply(e,arguments)}}(e[t]),void e.$$appendTrackers.push(o))})},e}])}(),function(e){"use strict";function t(e,t,r){t=t||"",r=r||512;for(var n=atob(e),o=[],i=0;i<n.length;i+=r){for(var a=n.slice(i,i+r),c=new Array(a.length),l=0;l<a.length;l++)c[l]=a.charCodeAt(l);var s=new Uint8Array(c);o.push(s)}return new Blob(o,{type:t})}var r,n="audio/wav";r={recorder:null,recorderOriginalWidth:0,recorderOriginalHeight:0,uploadFormId:null,uploadFieldName:null,isReady:!1,connect:function(e,t){if(-1!=navigator.appName.indexOf("Microsoft")?r.recorder=window[e]:r.recorder=document[e],!(t>=40))if(r.recorder&&r.recorder.init){if(r.recorderOriginalWidth=r.recorder.width,r.recorderOriginalHeight=r.recorder.height,r.uploadFormId&&$){var n=$(r.uploadFormId);r.recorder.init(n.attr("action").toString(),r.uploadFieldName,n.serializeArray())}}else setTimeout(function(){r.connect(e,t+1)},100)},playBack:function(e){r.recorder.playBack(e)},pausePlayBack:function(e){r.recorder.pausePlayBack(e)},playBackFrom:function(e,t){r.recorder.playBackFrom(e,t)},record:function(e,t){r.recorder.record(e,t)},stopRecording:function(){r.recorder.stopRecording()},stopPlayBack:function(){r.recorder.stopPlayBack()},observeLevel:function(){r.recorder.observeLevel()},stopObservingLevel:function(){r.recorder.stopObservingLevel()},observeSamples:function(){r.recorder.observeSamples()},stopObservingSamples:function(){r.recorder.stopObservingSamples()},resize:function(e,t){r.recorder.width=e+"px",r.recorder.height=t+"px"},defaultSize:function(){r.resize(r.recorderOriginalWidth,r.recorderOriginalHeight)},show:function(){r.recorder.show()},hide:function(){r.recorder.hide()},duration:function(e){return r.recorder.duration(e||r.uploadFieldName)},getBase64:function(e){var t=r.recorder.getBase64(e);return"data:"+n+";base64,"+t},getBlob:function(e){var o=r.getBase64(e).split(",")[1];return t(o,n)},getCurrentTime:function(e){return r.recorder.getCurrentTime(e)},isMicrophoneAccessible:function(){return r.recorder.isMicrophoneAccessible()},updateForm:function(){var e=$(r.uploadFormId);r.recorder.update(e.serializeArray())},showPermissionWindow:function(e){r.resize(240,160);var t=function(){e&&e.permanent?r.recorder.permitPermanently():r.recorder.permit()};setTimeout(t,1)},configure:function(e,t,n,o){switch(e=parseInt(e||22),t=parseInt(t||100),n=parseInt(n||0),o=parseInt(o||4e3),e){case 44:case 22:case 11:case 8:case 5:break;default:throw"invalid rate "+e}if(0>t||t>100)throw"invalid gain "+t;if(0>n||n>100)throw"invalid silenceLevel "+n;if(-1>o)throw"invalid silenceTimeout "+o;r.recorder.configure(e,t,n,o)},setUseEchoSuppression:function(e){if("boolean"!=typeof e)throw"invalid value for setting echo suppression, val: "+e;r.recorder.setUseEchoSuppression(e)},setLoopBack:function(e){if("boolean"!=typeof e)throw"invalid value for setting loop back, val: "+e;r.recorder.setLoopBack(e)}},e.FWRecorder=r}(window),function(){"use strict";var e=function(e,t){if("function"!=typeof e)throw"The specified parameter must be a valid function";var r=e.toString();if(r.match(/\[native\s*code\]/i))throw"You cannot bind a native function to a worker";t=t||{},"object"!=typeof t&&console.warn("Params must be an object that is serializable with JSON.stringify, specified is: "+typeof t);var n=window.URL.createObjectURL(new Blob(["(",r,")(this,",JSON.stringify(t),")"],{type:"application/javascript"}));return n};Function.prototype.toWorker=function(t){var r=e(this,t);return new Worker(r)}}(),function(e){"use strict";var t=function(e){function t(e){d=e.sampleRate}function r(e){f.push(e[0]),u+=e[0].length}function n(t){var r=a(f,u),n=s(r),o=new Blob([n],{type:t});e.postMessage(o)}function o(){var t=[];t.push(a(f,u)),t.push(a(p,u)),e.postMessage(t)}function i(){u=0,f=[],p=[]}function a(e,t){for(var r=new Float32Array(t),n=0,o=0;o<e.length;o++)r.set(e[o],n),n+=e[o].length;return r}function c(e,t,r){for(var n=0;n<r.length;n++,t+=2){var o=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,0>o?32768*o:32767*o,!0)}}function l(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}function s(e){var t=new ArrayBuffer(44+2*e.length),r=new DataView(t);return l(r,0,"RIFF"),r.setUint32(4,32+2*e.length,!0),l(r,8,"WAVE"),l(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,d,!0),r.setUint32(28,2*d,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),l(r,36,"data"),r.setUint32(40,2*e.length,!0),c(r,44,e),r}var d,u=0,f=[],p=[];e.onmessage=function(e){switch(e.data.command){case"init":t(e.data.config);break;case"record":r(e.data.buffer);break;case"exportWAV":n(e.data.type);break;case"getBuffer":o();break;case"clear":i()}}},r=function(e,r){var n=r||{},o=n.bufferLen||4096;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,o,2,2);var i=t.toWorker();i.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var a,c=!1;this.node.onaudioprocess=function(e){c&&i.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0)]})},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(){c=!0},this.stop=function(){c=!1},this.clear=function(){i.postMessage({command:"clear"})},this.getBuffer=function(e){a=e||n.callback,i.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(a=e||n.callback,t=t||n.type||"audio/wav",!a)throw new Error("Callback not set");i.postMessage({command:"exportWAV",type:t})},i.onmessage=function(e){var t=e.data;a(t)},e.connect(this.node),this.node.connect(this.context.destination)};e.Recorder=r}(window),function(e){"use strict";var t=function(e,t){console.log("MP3 conversion worker started."),"undefined"==typeof lamejs&&importScripts(t.lameJsUrl);var r,n,o,i,a,c,l=1152,s=function(){c=[]},d=function(e){c.push(new Int8Array(e))},u=function(e){a=e||{},i=new lamejs,s()},f=function(e){n=i.WavHeader.readHeader(new DataView(e)),console.log("wave:",n),o=new Int16Array(e,n.dataOffset,n.dataLen/2),r=new i.Mp3Encoder(n.channels,n.sampleRate,a.bitRate||128);for(var t=o.length,c=0;t>=l;c+=l){var s=o.subarray(c,c+l),u=r.encodeBuffer(s);d(u),t-=l}},p=function(){var e=r.flush();d(e),self.postMessage({cmd:"end",buf:c}),console.log("done encoding"),s()};e.onmessage=function(e){switch(e.data.cmd){case"init":u(e.data.config);break;case"encode":f(e.data.rawInput);break;case"finish":p()}}},r=function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].getAttribute("src"),r=t.substr(0,t.lastIndexOf("/")+1);if(r&&!r.match(/:\/\//)){var n=document.createElement("a");return n.href=r,n.href}return r}(),n=function(e){e=e||{},e.lameJsUrl=e.lameJsUrl||r+"/lame.min.js";var n=!1,o=t.toWorker(e);this.isBusy=function(){return n},this.convert=function(e){var t="conversion_"+Date.now(),r=t+":";console.log(r,"Starting conversion");var i,a,c={};switch(typeof arguments[1]){case"object":c=arguments[1];break;case"function":i=arguments[1];break;default:throw"parameter 2 is expected to be an object (config) or function (success callback)"}if("function"==typeof arguments[2]&&(i?a=arguments[2]:i=arguments[2]),"function"!=typeof arguments[3]||a||(a=arguments[3]),n)throw"Another conversion is in progress";var l=e.size,s=new FileReader,d=Date.now();s.onload=function(e){console.log(r,"Passed to BG process"),o.postMessage({cmd:"init",config:c}),o.postMessage({cmd:"encode",rawInput:e.target.result}),o.postMessage({cmd:"finish"}),o.onmessage=function(e){if("end"==e.data.cmd){console.log(r,"Done converting to Mp3");var t=new Blob(e.data.buf,{type:"audio/mp3"});console.log(r,"Conversion completed in: "+(Date.now()-d)/1e3+"s");var o=t.size;console.log(r+"Initial size: = "+l+", Final size = "+o+", Reduction: "+Number(100*(l-o)/l).toPrecision(4)+"%"),n=!1,i&&"function"==typeof i&&i(t)}}},n=!0,s.readAsArrayBuffer(e)}};e.MP3Converter=n}(window),function(e){"use strict";e.swfobject=function(){function e(){"complete"==b.readyState&&(b.parentNode.removeChild(b),t())}function t(){if(!x){if(j.ie&&j.win){var e=v("span");try{var t=I.getElementsByTagName("body")[0].appendChild(e);t.parentNode.removeChild(t)}catch(r){return}}x=!0,O&&(clearInterval(O),O=null);for(var n=E.length,o=0;n>o;o++)E[o]()}}function r(e){x?e():E[E.length]=e}function n(e){if(typeof M.addEventListener!=A)M.addEventListener("load",e,!1);else if(typeof I.addEventListener!=A)I.addEventListener("load",e,!1);else if(typeof M.attachEvent!=A)g(M,"onload",e);else if("function"==typeof M.onload){var t=M.onload;M.onload=function(){t(),e()}}else M.onload=e}function o(){for(var e=L.length,t=0;e>t;t++){var r=L[t].id;if(j.pv[0]>0){var n=p(r);n&&(L[t].width=n.getAttribute("width")?n.getAttribute("width"):"0",L[t].height=n.getAttribute("height")?n.getAttribute("height"):"0",m(L[t].swfVersion)?(j.webkit&&j.webkit<312&&i(n),w(r,!0)):L[t].expressInstall&&!U&&m("6.0.65")&&(j.win||j.mac)?a(L[t]):c(n))}else w(r,!0)}}function i(e){var t=e.getElementsByTagName(R)[0];if(t){var r=v("embed"),n=t.attributes;if(n)for(var o=n.length,i=0;o>i;i++)"DATA"==n[i].nodeName?r.setAttribute("src",n[i].nodeValue):r.setAttribute(n[i].nodeName,n[i].nodeValue);var a=t.childNodes;if(a)for(var c=a.length,l=0;c>l;l++)1==a[l].nodeType&&"PARAM"==a[l].nodeName&&r.setAttribute(a[l].getAttribute("name"),a[l].getAttribute("value"));e.parentNode.replaceChild(r,e)}}function a(e){U=!0;var t=p(e.id);if(t){if(e.altContentId){var r=p(e.altContentId);r&&(T=r,W=e.altContentId)}else T=l(t);!/%$/.test(e.width)&&parseInt(e.width,10)<310&&(e.width="310"),!/%$/.test(e.height)&&parseInt(e.height,10)<137&&(e.height="137"),I.title=I.title.slice(0,47)+" - Flash Player Installation";var n=j.ie&&j.win?"ActiveX":"PlugIn",o=I.title,i="MMredirectURL="+M.location+"&MMplayerType="+n+"&MMdoctitle="+o,a=e.id;if(j.ie&&j.win&&4!=t.readyState){var c=v("div");a+="SWFObjectNew",c.setAttribute("id",a),t.parentNode.insertBefore(c,t),t.style.display="none";var d=function(){t.parentNode.removeChild(t)};g(M,"onload",d)}s({data:e.expressInstall,id:P,width:e.width,height:e.height},{flashvars:i},a)}}function c(e){if(j.ie&&j.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(l(e),t),e.style.display="none";var r=function(){e.parentNode.removeChild(e)};g(M,"onload",r)}else e.parentNode.replaceChild(l(e),e)}function l(e){var t=v("div");if(j.win&&j.ie)t.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(R)[0];if(r){var n=r.childNodes;if(n)for(var o=n.length,i=0;o>i;i++)1==n[i].nodeType&&"PARAM"==n[i].nodeName||8==n[i].nodeType||t.appendChild(n[i].cloneNode(!0))}}return t}function s(e,t,r){var n,o=p(r);if(o)if(typeof e.id==A&&(e.id=r),j.ie&&j.win){var i="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?i+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(i+=" "+a+'="'+e[a]+'"'));var c="";for(var l in t)t[l]!=Object.prototype[l]&&(c+='<param name="'+l+'" value="'+t[l]+'" />');o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+c+"</object>",N[N.length]=e.id,n=p(e.id)}else if(j.webkit&&j.webkit<312){var s=v("embed");s.setAttribute("type",S);for(var u in e)e[u]!=Object.prototype[u]&&("data"==u.toLowerCase()?s.setAttribute("src",e[u]):"styleclass"==u.toLowerCase()?s.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&s.setAttribute(u,e[u]));for(var f in t)t[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&s.setAttribute(f,t[f]);o.parentNode.replaceChild(s,o),n=s}else{var g=v(R);g.setAttribute("type",S);for(var m in e)e[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?g.setAttribute("class",e[m]):"classid"!=m.toLowerCase()&&g.setAttribute(m,e[m]));for(var h in t)t[h]!=Object.prototype[h]&&"movie"!=h.toLowerCase()&&d(g,h,t[h]);o.parentNode.replaceChild(g,o),n=g}return n}function d(e,t,r){var n=v("param");n.setAttribute("name",t),n.setAttribute("value",r),e.appendChild(n)}function u(e){var t=p(e);!t||"OBJECT"!=t.nodeName&&"EMBED"!=t.nodeName||(j.ie&&j.win?4==t.readyState?f(e):M.attachEvent("onload",function(){f(e)}):t.parentNode.removeChild(t))}function f(e){var t=p(e);if(t){for(var r in t)"function"==typeof t[r]&&(t[r]=null);t.parentNode.removeChild(t)}}function p(e){var t=null;try{t=I.getElementById(e)}catch(r){}return t}function v(e){return I.createElement(e)}function g(e,t,r){e.attachEvent(t,r),B[B.length]=[e,t,r]}function m(e){var t=j.pv,r=e.split(".");return r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10)||0,r[2]=parseInt(r[2],10)||0,t[0]>r[0]||t[0]==r[0]&&t[1]>r[1]||t[0]==r[0]&&t[1]==r[1]&&t[2]>=r[2]}function h(e,t){if(!j.ie||!j.mac){var r=I.getElementsByTagName("head")[0],n=v("style");if(n.setAttribute("type","text/css"),n.setAttribute("media","screen"),j.ie&&j.win||typeof I.createTextNode==A||n.appendChild(I.createTextNode(e+" {"+t+"}")),r.appendChild(n),j.ie&&j.win&&typeof I.styleSheets!=A&&I.styleSheets.length>0){var o=I.styleSheets[I.styleSheets.length-1];typeof o.addRule==R&&o.addRule(e,t)}}}function w(e,t){var r=t?"visible":"hidden";x&&p(e)?p(e).style.visibility=r:h("#"+e,"visibility:"+r)}function y(e){var t=/[\\\"<>\.;]/,r=null!=t.exec(e);return r?encodeURIComponent(e):e}var b,A="undefined",R="object",k="Shockwave Flash",C="ShockwaveFlash.ShockwaveFlash",S="application/x-shockwave-flash",P="SWFObjectExprInst",M=window,I=document,F=navigator,E=[],L=[],N=[],B=[],O=null,T=null,W=null,x=!1,U=!1,j=function(){var e=typeof I.getElementById!=A&&typeof I.getElementsByTagName!=A&&typeof I.createElement!=A,t=[0,0,0],r=null;if(typeof F.plugins!=A&&typeof F.plugins[k]==R)r=F.plugins[k].description,!r||typeof F.mimeTypes!=A&&F.mimeTypes[S]&&!F.mimeTypes[S].enabledPlugin||(r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),t[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),t[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),t[2]=/r/.test(r)?parseInt(r.replace(/^.*r(.*)$/,"$1"),10):0);else if(typeof M.ActiveXObject!=A){var n=null,o=!1;try{n=new ActiveXObject(C+".7")}catch(i){try{n=new ActiveXObject(C+".6"),t=[6,0,21],n.AllowScriptAccess="always"}catch(i){6==t[0]&&(o=!0)}if(!o)try{n=new ActiveXObject(C)}catch(i){}}if(!o&&n)try{r=n.GetVariable("$version"),r&&(r=r.split(" ")[1].split(","),t=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}catch(i){}}var a=F.userAgent.toLowerCase(),c=F.platform.toLowerCase(),l=/webkit/.test(a)?parseFloat(a.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,d=c?/win/.test(c):/win/.test(a),u=c?/mac/.test(c):/mac/.test(a);return{w3cdom:e,pv:t,webkit:l,ie:s,win:d,mac:u}}();(function(){if(j.w3cdom){if(r(o),j.ie&&j.win)try{I.write("<script id=__ie_ondomload defer=true src=//:></script>"),b=p("__ie_ondomload"),b&&g(b,"onreadystatechange",e)}catch(i){}j.webkit&&typeof I.readyState!=A&&(O=setInterval(function(){/loaded|complete/.test(I.readyState)&&t()},10)),typeof I.addEventListener!=A&&I.addEventListener("DOMContentLoaded",t,null),n(t)}})(),function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var e=B.length,t=0;e>t;t++)B[t][0].detachEvent(B[t][1],B[t][2]);for(var r=N.length,n=0;r>n;n++)u(N[n]);for(var o in j)j[o]=null;j=null;for(var i in swfobject)swfobject[i]=null;swfobject=null})}();return{registerObject:function(e,t,r){if(j.w3cdom&&e&&t){var n={};n.id=e,n.swfVersion=t,n.expressInstall=r?r:!1,L[L.length]=n,w(e,!1)}},getObjectById:function(e){var t=null;if(j.w3cdom){var r=p(e);if(r){var n=r.getElementsByTagName(R)[0];!n||n&&typeof r.SetVariable!=A?t=r:typeof n.SetVariable!=A&&(t=n)}}return t},embedSWF:function(e,t,n,o,i,c,l,d,u){if(j.w3cdom&&e&&t&&n&&o&&i)if(n+="",o+="",m(i)){w(t,!1);var f={};if(u&&typeof u===R)for(var p in u)u[p]!=Object.prototype[p]&&(f[p]=u[p]);f.data=e,f.width=n,f.height=o;var v={};if(d&&typeof d===R)for(var g in d)d[g]!=Object.prototype[g]&&(v[g]=d[g]);if(l&&typeof l===R)for(var h in l)l[h]!=Object.prototype[h]&&(typeof v.flashvars!=A?v.flashvars+="&"+h+"="+l[h]:v.flashvars=h+"="+l[h]);r(function(){s(f,v,t),f.id==t&&w(t,!0)})}else c&&!U&&m("6.0.65")&&(j.win||j.mac)&&(U=!0,w(t,!1),r(function(){var e={};e.id=e.altContentId=t,e.width=n,e.height=o,e.expressInstall=c,a(e)}))},getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:m,createSWF:function(e,t,r){return j.w3cdom?s(e,t,r):void 0},removeSWF:function(e){j.w3cdom&&u(e)},createCSS:function(e,t){j.w3cdom&&h(e,t)},addDomLoadEvent:r,addLoadEvent:n,getQueryParamValue:function(e){var t=I.location.search||I.location.hash;if(null==e)return y(t);if(t)for(var r=t.substring(1).split("&"),n=0;n<r.length;n++)if(r[n].substring(0,r[n].indexOf("="))==e)return y(r[n].substring(r[n].indexOf("=")+1));return""},expressInstallCallback:function(){if(U&&T){var e=p(P);e&&(e.parentNode.replaceChild(T,e),W&&(w(W,!0),j.ie&&j.win&&(T.style.display="block")),T=null,W=null,U=!1)}}}}()}(window);